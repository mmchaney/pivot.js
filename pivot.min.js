(function(e){function d(a,b,c){this.element=a;this.setType(b);this.element.addEventListener(b,c,false);this.onTouchEnd=this.onTouchEnd.bind(this);this.onTouchMove=this.onTouchMove.bind(this);this.onTouchStart=this.onTouchStart.bind(this);this.element.addEventListener("touchstart",this.onTouchStart,false)}var f=e.pivot||(e.pivot={}),g=e.document;f.util={};f.util.slice=[].slice;Modernizr.addTest("skia",function(){return/Win/.test(e.navigator.platform)&&/Chrome/.test(e.navigator.userAgent)});Modernizr.addTest("devicemotion",
function(){return e.ondevicemotion!==undefined});Modernizr.addTest("webkitmatchesselector",function(){return Element&&!!Element.prototype.webkitMatchesSelector});Modernizr.addTest("webkitcssmatrix",function(){return!!e.WebKitCSSMatrix});d.availableEvents=["swipeleft","swiperight"];d.prototype={setType:function(a){this.type=a.toLowerCase();this.event=g.createEvent("Events");this.event.initEvent(a,true,false)},dispatchEvent:function(a,b){this.type===b.toLowerCase()&&a.dispatchEvent(this.event)},getCoords:function(a){return{x:a.touches[0].pageX,
y:a.touches[0].pageY}},onTouchStart:function(a){if(this.startCoords=this.getCoords(a)){this.element.addEventListener("touchend",this.onTouchEnd,false);this.element.addEventListener("touchmove",this.onTouchMove,false)}},onTouchMove:function(a){this.moveCoords=this.getCoords(a)},onTouchEnd:function(a){var b;this.element.removeEventListener("touchend",this.onTouchEnd,false);this.element.removeEventListener("touchmove",this.onTouchMove,false);if(this.moveCoords){b={x:this.startCoords.x-this.moveCoords.x,
y:this.startCoords.y-this.moveCoords.y};if(Math.abs(b.x)>30||Math.abs(b.y)>30)this.dispatchEvent(a.target,b.x>0?"swipeleft":"swiperight");delete this.moveCoords}}};f.util.makeElement=function(a,b){var c=g.createElement(a),h;for(h in b)if(h==="class")c.className=b[h];else c.setAttribute(h,b[h]);return c};f.util.delegate=function(a,b,c,h){a.addEventListener(c,function(j){for(var i=j.target,k=f.util.slice.call(a.querySelectorAll(b));i&&k.indexOf(i)<0;)i=i.parentNode;i&&i!==a&&i!==g&&h.call(i,j)},false)};
f.util.ancestor=function(a,b){for(;a!==g&&!a.webkitMatchesSelector(b);)a=a.parentNode;return a};f.util.supplant=function(a){var b=f.util.slice.call(arguments),c=0,h;return typeof b[1]==="object"?a.replace(/\{(\w+)\}/g,function(j,i){return b[1][i]!==undefined?b[1][i]:j}):a.replace(/\{(\w*)\}/g,function(j){h=b[++c];return h!==undefined?h:j})};f.util.getJSON=function(a,b){var c=new XMLHttpRequest;c.addEventListener("readystatechange",function(){c.readyState===4&&c.status===200&&b(JSON.parse(c.responseText))},
false);c.open("GET",a,true);c.send()};f.util.localCoordinates=function(a,b){var c;b=b||a.target;c=b.getBoundingClientRect();return{x:Math.max(0,Math.min(1,(a.clientX-c.left)/c.width)),y:Math.max(0,Math.min(1,(a.clientY-c.top)/c.height)),box:c}};f.util.mod=function(a,b){return(a%b+b)%b};f.util.gesturize=function(a,b,c){return new d(a,b,c)};f.util.preventTouchScroll=function(a){a.addEventListener("touchmove",function(b){b.preventDefault()},false)};Function.prototype.bind=Function.prototype.bind||function(a){var b=
this,c=f.util.slice.call(arguments,1);return function(){return b.apply(a,c.concat(f.util.slice.call(arguments)))}};if(Object.prototype.__defineGetter__&&!Object.defineProperty)Object.defineProperty=function(a,b,c){"get"in c&&a.__defineGetter__(b,c.get);"set"in c&&a.__defineSetter__(b,c.set)};typeof Element!=="undefined"&&!Element.hasOwnProperty.call(Element.prototype,"classList")&&function(){var a=function(c){return RegExp("(^|\\s)"+c+"(\\s|$)")},b=function(c){this.element=c};b.prototype={contains:function(c){return a(c).test(this.element.className)},
add:function(c){this.contains(c)||(this.element.className+=(this.element.className?" ":"")+c)},remove:function(c){this.element.className=this.element.className.replace(a(c)," ").trim()},toggle:function(c){var h=a(c);if(h.test(this.element.className))this.element.className=this.element.className.replace(h," ").trim();else this.element.className+=(this.element.className?" ":"")+c}};Object.defineProperty(Element.prototype,"classList",{get:function(){return new b(this)}})}()})(this);
(function(e){var d=e.pivot||(e.pivot={}),f=e.document,g=d.util.supplant;d.Gallery=function(a){var b;this.wrapper=a.wrapper||f.body;this.quality=a.quality||"medium";this.rows=a.rows;this.columns=a.columns;this.page=1;this.perPage=this.rows*this.columns;b={perPage:this.rows*this.columns};if(a.userId){this.feed=d.flickr.feeds.user;b.userId=a.userId}else if(a.groupId){this.feed=d.flickr.feeds.group;b.groupId=a.groupId}else this.feed=d.flickr.feeds.interesting;this.feed=g(this.feed,b);this.photoLoadCount=
0;this.photos=[];this.allowedRotation=a.allowedRotation||e.orientation?120:90;this.tiltLag=7;this.rotationDelta={x:0,y:0};this.movementCoordinates={x:0,y:0};this.currentRotation={x:0,y:0};this.onFlickrResult=this.onFlickrResult.bind(this);this.getNextFlickrPage=this.getNextFlickrPage.bind(this);this.constrainLayout=this.constrainLayout.bind(this);this.tilt=this.tilt.bind(this);this.container=d.util.makeElement("div",{"class":"pivot"});a.wrapper||this.container.classList.add("fullscreen");this.wrapper.appendChild(this.container);
this.viewport=d.util.makeElement("div",{"class":"p-viewport"});this.zoomPlane=d.util.makeElement("div",{"class":"p-zoom-plane"});this.viewport.appendChild(this.zoomPlane);this.tiltPlane=d.util.makeElement("div",{"class":"p-tilt-plane"});this.zoomPlane.appendChild(this.tiltPlane);this.trackingPlane=d.util.makeElement("div",{"class":"p-tracking-plane"});this.tiltPlane.appendChild(this.trackingPlane);for(a=0;a<this.rows;a++)for(b=0;b<this.columns;b++)this.photos.push(new d.Photo({container:this.trackingPlane,
row:a,column:b,rows:this.rows,quality:this.quality}));this.controls=d.util.makeElement("div",{"class":"p-controls"});this.refresh=d.util.makeElement("button",{"class":"p-refresh"});this.controls.appendChild(this.refresh);this.constrainLayout();this.container.appendChild(this.viewport);this.container.appendChild(this.controls);e.addEventListener("resize",this.constrainLayout,false);this.trackingPlane.addEventListener("load",this.onPhotoLoaded.bind(this),false);f.addEventListener("keydown",this.onKeyDown.bind(this),
false);d.util.delegate(this.viewport,".p-photo","click",this.onPhotoClickDelegate.bind(this));this.viewport.addEventListener("mousewheel",this.onViewportMouseWheel.bind(this),false);this.refresh.addEventListener("click",this.getNextFlickrPage,false);this.zoomOut=this.zoomOut.bind(this);this.container.addEventListener("click",this.zoomOut,false);if(Modernizr.devicemotion){e.addEventListener("devicemotion",this.onDeviceMotion.bind(this),false);e.addEventListener("orientationchange",this.constrainLayout,
false)}else this.container.addEventListener("mousemove",this.onContainerMouseMove.bind(this),false);if(Modernizr.touch){d.util.preventTouchScroll(f.body);d.util.gesturize(this.viewport,"swipeleft",this.cycle.bind(this,"next"),true,false);d.util.gesturize(this.viewport,"swiperight",this.cycle.bind(this,"prev"),true,false)}this.zoomOut();this.getFlickrPage=this.getFlickrPage.bind(this);setTimeout(this.getFlickrPage,400);this.setSelectedPhoto(this.getPhoto(0,0))};d.Gallery.prototype={matrix:Modernizr.webkitcssmatrix?
new WebKitCSSMatrix:undefined,constrainLayout:function(){var a=this.container.offsetWidth,b=this.container.offsetHeight;this.zoomPlane.style.width=this.zoomPlane.style.height=Math.min(a,b)+"px";if(a>b){this.zoomPlane.style.left=(a-b)/2+"px";this.zoomPlane.style.top=0}else{this.zoomPlane.style.top=(b-a)/2+"px";this.zoomPlane.style.left=0}},getPhoto:function(a,b){return this.container.querySelector(g('.p-photo[data-row="{row}"][data-column="{column}"]',a,b))},getSelectedPhoto:function(){return this.container.querySelector(".p-photo.selected")},
setSelectedPhoto:function(a){var b=this.getSelectedPhoto();if(b){b.classList.remove("selected");b.classList.remove("flipped")}a.classList.add("selected");this.track();return a},cycle:function(a){var b=this.getSelectedPhoto(),c=b?parseInt(b.getAttribute("data-row"),10):0;b=b?parseInt(b.getAttribute("data-column"),10):0;switch(a){case "left":b=d.util.mod(b-1,this.columns);break;case "right":b=(b+1)%this.columns;break;case "up":c=d.util.mod(c-1,this.rows);break;case "down":c=(c+1)%this.rows;break;case "next":if(b<
this.columns-1)b++;else{b=0;c=c<this.rows-1?c+1:0}break;case "prev":if(b)b--;else{b=this.columns-1;c=c?c-1:this.rows-1}break}this.setSelectedPhoto(this.getPhoto(c,b))},sendFlickrRequest:function(a){this.photoLoadCount=0;this.container.classList.add("gallery-loading");d.util.getJSON(a,this.onFlickrResult)},onFlickrResult:function(a){a.photos.photo.forEach(function(b,c){this.photos[c].insertFlickrData(b)},this);this.photoLoadCount+=this.photos.length-a.photos.photo.length;this.photos.slice(a.photos.photo.length).forEach(function(b){b.setSource("")})},
getFlickrPage:function(a){this.page=a>0?a:1;this.sendFlickrRequest(g(this.feed,{page:this.page}))},getNextFlickrPage:function(){this.getFlickrPage(this.page+1)},zoomIn:function(){this.container.classList.add("zoomed");this.zoomed=true;this.zoomPlane.style.webkitTransform=this.matrix;this.track();this.tilting||this.tilt()},zoomOut:function(){this.container.classList.remove("zoomed");this.zoomed=false;this.zoomPlane.style.webkitTransform=this.matrix.translate(0,0,-this.rows*800);this.track()},track:function(){var a;
if(this.zoomed){a=this.getSelectedPhoto();a=g("translate3d({x}%, {y}%, -150px)",{x:a.getAttribute("data-column")*-100,y:a.getAttribute("data-row")*-100})}else a=g("translate3d({x}%, {y}%, 1px)",{x:this.columns/2*-100+50,y:this.rows/2*-100+50});this.trackingPlane.style.webkitTransform=a},tilt:function(){var a=this.zoomed&&e.orientation===undefined?this.allowedRotation/4:this.allowedRotation;this.tilting=true;this.rotationDelta.x=(a*(this.movementCoordinates.y-0.5)-this.currentRotation.x)/this.tiltLag;
this.rotationDelta.y=(a*(this.movementCoordinates.x-0.5)+this.currentRotation.y)/this.tiltLag;this.currentRotation.x+=this.rotationDelta.x;this.currentRotation.y-=this.rotationDelta.y;this.tiltPlane.style.webkitTransform=this.matrix.rotate(this.currentRotation.x,this.currentRotation.y,0);if(Math.abs(this.rotationDelta.x)+Math.abs(this.rotationDelta.y)>0.05)setTimeout(this.tilt,1E3/30);else this.tilting=false},onPhotoLoaded:function(){this.photoLoadCount++;this.photoLoadCount===this.photos.length&&
this.container.classList.remove("gallery-loading")},onPhotoClickDelegate:function(a){var b=d.util.ancestor(a.target,".p-photo");a.target!==b&&a.stopPropagation();this.setSelectedPhoto(b);this.zoomed||this.zoomIn()},onViewportMouseWheel:function(a){a.wheelDelta<0?this.zoomOut():this.onPhotoClickDelegate(a)},onKeyDown:function(a){switch(a.keyCode){case 37:this.cycle("left");break;case 39:this.cycle("right");break;case 38:this.cycle("up");break;case 40:this.cycle("down");break;case 13:this.getSelectedPhoto().classList.toggle("flipped");
break;case 82:this.getNextFlickrPage();break;case 32:this.zoomed?this.zoomOut():this.zoomIn();break}},onContainerMouseMove:function(a){this.movementCoordinates=d.util.localCoordinates(a,this.container);this.tilting||this.tilt()},onDeviceMotion:function(a){var b=e.orientation%180===0,c=b?"x":"y";b=b?"y":"x";var h;h={x:e.orientation===180||e.orientation===90?-1:1,y:e.orientation===0||e.orientation===90?-1:1};this.movementCoordinates.x=(h[c]*a.accelerationIncludingGravity[c]+10)/20;this.movementCoordinates.y=
(h[b]*a.accelerationIncludingGravity[b]+10)/20;this.tilting||this.tilt()},onOrientationChange:function(){this.constrainLayout()}};d.setup=function(a){if(Modernizr&&Modernizr.webkitcssmatrix&&Modernizr.webkitmatchesselector&&Modernizr.csstransforms3d)return new d.Gallery(a)}})(this);
(function(e){var d=e.pivot||(e.pivot={}),f=e.document,g=d.util.supplant;d.Photo=function(a){this.row=a.row;this.column=a.column;this.rows=a.rows;this.quality=a.quality;this.loadEvent=f.createEvent("Events");this.loadEvent.initEvent("load",true,false);this.container=d.util.makeElement("figure",{"class":"p-photo loading no-img","data-row":this.row,"data-column":this.column});this.container.style.webkitTransform=g("translate3d({x}%, {y}%, 1px)",{x:this.column*100,y:this.row*100});this.backing=d.util.makeElement("div",
{"class":"p-backing"});this.backing.style.cssText=g("-webkit-transform: translate3d({x}px, {y}px, {z}px) rotate({r}deg); opacity: 0;",{x:Math.random()*2E3-1E3,y:Math.random()*2E3-1E3,z:Math.random()*-16000,r:Math.random()*-16000});this.container.appendChild(this.backing);this.imageWrapper=d.util.makeElement("div",{"class":"p-image-wrapper"});this.container.appendChild(this.imageWrapper);this.caption=d.util.makeElement("figcaption");this.imageWrapper.appendChild(this.caption);this.image=d.util.makeElement("img",
{draggable:false});this.imageWrapper.appendChild(this.image);this.imagePreloader=new Image;a.container.appendChild(this.container);this.completeLoading=this.completeLoading.bind(this);this.imagePreloader.addEventListener("load",this.onImagePreloaderLoad.bind(this),false);this.imagePreloader.addEventListener("error",this.onImagePreloaderError.bind(this),false);this.imageWrapper.addEventListener("click",this.onImageWrapperClick.bind(this),false);this.backing.addEventListener("webkitAnimationEnd",this.onBackingAnimationEnd.bind(this),
false);setTimeout(this.resetBackingTransform.bind(this),0)};d.Photo.prototype={setSource:function(a){if(this.image.src!==a){this.container.classList.add("loading");this.container.classList.remove("flipped");this.imagePreloader.src=a}else this.onImagePreloaderError()},setCaption:function(a){this.caption.innerHTML=a},insertFlickrData:function(a){a.pageURL=g(d.flickr.pageURL,a);a.title=a.title||"Untitled";this.setCaption(g(d.flickr.captionTemplate,a));this.setSource(g(d.flickr.sourceURLs[this.quality],
a))},resetBackingTransform:function(){this.backing.style.cssText=""},completeLoading:function(){this.image.src=this.imagePreloader.src;var a=this.image.naturalWidth/this.image.naturalHeight;this.wrapperDimensions=a>1?g("top: {top}%; left: 5%; width: 90%; height: {height}%;",{top:(100-90/a)/2,height:90/a}):g("top: 5%; left: {left}%; width: {width}%; height: 90%;",{left:(100-90*a)/2,width:90*a});this.imageWrapper.style.cssText=this.wrapperDimensions;this.container.classList.remove("loading");this.container.classList.remove("no-img");
this.container.classList.add("done-loading");this.container.dispatchEvent(this.loadEvent)},onBackingAnimationEnd:function(){this.backing.style.cssText=this.wrapperDimensions;this.container.classList.remove("done-loading")},onImagePreloaderLoad:function(){setTimeout(this.completeLoading,(this.column+this.row*this.rows)*250)},onImagePreloaderError:function(){this.container.classList.add("no-img");this.container.dispatchEvent(this.loadEvent)},onImageWrapperClick:function(a){if(this.container.webkitMatchesSelector(".pivot.zoomed .p-photo.selected")){a.stopPropagation();
this.container.classList.toggle("flipped")}}}})(this);
(function(e){(e.pivot||(e.pivot={})).flickr={captionTemplate:'<h1><a href="{pageURL}" target="blank" tabindex="-1">{title}</a></h1><p> By {ownername}</p>',sourceURLs:{high:"http://farm{farm}.static.flickr.com/{server}/{id}_{secret}_b.jpg",medium:"http://farm{farm}.static.flickr.com/{server}/{id}_{secret}_z.jpg",low:"http://farm{farm}.static.flickr.com/{server}/{id}_{secret}_m.jpg"},pageURL:"http://www.flickr.com/photos/{owner}/{id}",feeds:{user:"http://api.flickr.com/services/rest/?method=flickr.people.getPublicPhotos&api_key=6fff138dbd0fbe330c07a67c47c9cc21&user_id={userId}&per_page={perPage}&page={page}&extras=description,owner_name&format=json&nojsoncallback=1",group:"http://api.flickr.com/services/rest/?method=flickr.groups.pools.getPhotos&api_key=6fff138dbd0fbe330c07a67c47c9cc21&group_id={groupId}&per_page={perPage}&page={page}&extras=description,owner_name&format=json&nojsoncallback=1",
interesting:"http://api.flickr.com/services/rest/?method=flickr.interestingness.getList&api_key=6fff138dbd0fbe330c07a67c47c9cc21&per_page={perPage}&page={page}&extras=description,owner_name&format=json&nojsoncallback=1"}}})(this);