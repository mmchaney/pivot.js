(function(f){function d(c,a,b){this.element=c;this.setType(a);this.element.addEventListener(a,b,false);this.onTouchEnd=this.onTouchEnd.bind(this);this.onTouchMove=this.onTouchMove.bind(this);this.onTouchStart=this.onTouchStart.bind(this);this.element.addEventListener("touchstart",this.onTouchStart,false)}var g=f.pivot||(f.pivot={}),h=f.document;g.util={};g.util.slice=[].slice;Modernizr.addTest("skia",function(){return/Win/.test(f.navigator.platform)&&/Chrome/.test(f.navigator.userAgent)});Modernizr.addTest("devicemotion",
function(){return f.ondevicemotion!==undefined});Modernizr.addTest("webkitmatchesselector",function(){return Element&&!!Element.prototype.webkitMatchesSelector});d.availableEvents=["swipeleft","swiperight"];d.prototype={setType:function(c){this.type=c.toLowerCase();this.event=h.createEvent("Events");this.event.initEvent(c,true,false)},dispatchEvent:function(c,a){this.type===a.toLowerCase()&&c.dispatchEvent(this.event)},getCoords:function(c){return{x:c.touches[0].pageX,y:c.touches[0].pageY}},onTouchStart:function(c){if(this.startCoords=
this.getCoords(c)){this.element.addEventListener("touchend",this.onTouchEnd,false);this.element.addEventListener("touchmove",this.onTouchMove,false)}},onTouchMove:function(c){this.moveCoords=this.getCoords(c)},onTouchEnd:function(c){var a;this.element.removeEventListener("touchend",this.onTouchEnd,false);this.element.removeEventListener("touchmove",this.onTouchMove,false);if(this.moveCoords){a={x:this.startCoords.x-this.moveCoords.x,y:this.startCoords.y-this.moveCoords.y};if(Math.abs(a.x)>30||Math.abs(a.y)>
30)this.dispatchEvent(c.target,a.x>0?"swipeleft":"swiperight");delete this.moveCoords}}};g.util.makeElement=function(c,a){var b=h.createElement(c),e;for(e in a)if(e==="class")b.className=a[e];else b.setAttribute(e,a[e]);return b};g.util.delegate=function(c,a,b,e){c.addEventListener(b,function(j){for(var i=j.target,k=g.util.slice.call(c.querySelectorAll(a));i&&k.indexOf(i)<0;)i=i.parentNode;i&&i!==c&&i!==h&&e.call(i,j)},false)};g.util.ancestor=function(c,a){for(;c!==h&&!c.webkitMatchesSelector(a);)c=
c.parentNode;return c};g.util.supplant=function(c){var a=g.util.slice.call(arguments),b=0,e;return typeof a[1]==="object"?c.replace(/\{(\w+)\}/g,function(j,i){return a[1][i]!==undefined?a[1][i]:j}):c.replace(/\{(\w*)\}/g,function(j){e=a[++b];return e!==undefined?e:j})};g.util.getJSON=function(c,a){var b=new XMLHttpRequest;b.addEventListener("readystatechange",function(){b.readyState===4&&b.status===200&&a(JSON.parse(b.responseText))},false);b.open("GET",c,true);b.send()};g.util.localCoordinates=function(c,
a){var b;a=a||c.target;b=a.getBoundingClientRect();return{x:Math.max(0,Math.min(1,(c.clientX-b.left)/b.width)),y:Math.max(0,Math.min(1,(c.clientY-b.top)/b.height)),box:b}};g.util.mod=function(c,a){return(c%a+a)%a};g.util.gesturize=function(c,a,b){return new d(c,a,b)};g.util.preventTouchScroll=function(c){c.addEventListener("touchmove",function(a){a.preventDefault()},false)};Function.prototype.bind=Function.prototype.bind||function(c){var a=this,b=g.util.slice.call(arguments,1);return function(){return a.apply(c,
b.concat(g.util.slice.call(arguments)))}};if(Object.prototype.__defineGetter__&&!Object.defineProperty)Object.defineProperty=function(c,a,b){"get"in b&&c.__defineGetter__(a,b.get);"set"in b&&c.__defineSetter__(a,b.set)};typeof Element!=="undefined"&&!Element.hasOwnProperty.call(Element.prototype,"classList")&&function(){var c=function(b){return RegExp("(^|\\s)"+b+"(\\s|$)")},a=function(b){this.element=b};a.prototype={contains:function(b){return c(b).test(this.element.className)},add:function(b){this.contains(b)||
(this.element.className+=(this.element.className?" ":"")+b)},remove:function(b){this.element.className=this.element.className.replace(c(b)," ").trim()},toggle:function(b){var e=c(b);if(e.test(this.element.className))this.element.className=this.element.className.replace(e," ").trim();else this.element.className+=(this.element.className?" ":"")+b}};Object.defineProperty(Element.prototype,"classList",{get:function(){return new a(this)}})}()})(this);
(function(f){var d=f.pivot||(f.pivot={}),g=f.document,h=d.util.supplant,c=new WebKitCSSMatrix;d.Gallery=function(a){var b;this.wrapper=a.wrapper||g.body;this.quality=a.quality||"medium";this.rows=a.rows;this.columns=a.columns;this.page=1;this.perPage=this.rows*this.columns;b={perPage:this.rows*this.columns};if(a.userId){this.feed=d.flickr.feeds.user;b.userId=a.userId}else if(a.groupId){this.feed=d.flickr.feeds.group;b.groupId=a.groupId}else this.feed=d.flickr.feeds.interesting;this.feed=h(this.feed,
b);this.photoLoadCount=0;this.photos=[];this.allowedRotation=a.allowedRotation||f.orientation?120:90;this.tiltLag=7;this.rotationDelta={x:0,y:0};this.movementCoordinates={x:0,y:0};this.currentRotation={x:0,y:0};this.onFlickrResult=this.onFlickrResult.bind(this);this.getNextFlickrPage=this.getNextFlickrPage.bind(this);this.constrainLayout=this.constrainLayout.bind(this);this.tilt=this.tilt.bind(this);this.container=d.util.makeElement("div",{"class":"pivot"});a.wrapper||this.container.classList.add("fullscreen");
this.wrapper.appendChild(this.container);this.viewport=d.util.makeElement("div",{"class":"p-viewport"});this.zoomPlane=d.util.makeElement("div",{"class":"p-zoom-plane"});this.viewport.appendChild(this.zoomPlane);this.tiltPlane=d.util.makeElement("div",{"class":"p-tilt-plane"});this.zoomPlane.appendChild(this.tiltPlane);this.trackingPlane=d.util.makeElement("div",{"class":"p-tracking-plane"});this.tiltPlane.appendChild(this.trackingPlane);for(a=0;a<this.rows;a++)for(b=0;b<this.columns;b++)this.photos.push(new d.Photo({container:this.trackingPlane,
row:a,column:b,rows:this.rows,quality:this.quality}));this.controls=d.util.makeElement("div",{"class":"p-controls"});this.refresh=d.util.makeElement("button",{"class":"p-refresh"});this.controls.appendChild(this.refresh);this.constrainLayout();this.container.appendChild(this.viewport);this.container.appendChild(this.controls);f.addEventListener("resize",this.constrainLayout,false);this.trackingPlane.addEventListener("load",this.onPhotoLoaded.bind(this),false);g.addEventListener("keydown",this.onKeyDown.bind(this),
false);d.util.delegate(this.viewport,".p-photo","click",this.onPhotoClickDelegate.bind(this));this.viewport.addEventListener("mousewheel",this.onViewportMouseWheel.bind(this),false);this.refresh.addEventListener("click",this.getNextFlickrPage,false);this.zoomOut=this.zoomOut.bind(this);this.container.addEventListener("click",this.zoomOut,false);if(Modernizr.devicemotion){f.addEventListener("devicemotion",this.onDeviceMotion.bind(this),false);f.addEventListener("orientationchange",this.constrainLayout,
false)}else this.container.addEventListener("mousemove",this.onContainerMouseMove.bind(this),false);if(Modernizr.touch){d.util.preventTouchScroll(g.body);d.util.gesturize(this.viewport,"swipeleft",this.cycle.bind(this,"next"),true,false);d.util.gesturize(this.viewport,"swiperight",this.cycle.bind(this,"prev"),true,false)}this.zoomOut();this.getFlickrPage=this.getFlickrPage.bind(this);setTimeout(this.getFlickrPage,400);this.setSelectedPhoto(this.getPhoto(0,0))};d.Gallery.prototype={constrainLayout:function(){var a=
this.container.offsetWidth,b=this.container.offsetHeight;this.zoomPlane.style.width=this.zoomPlane.style.height=Math.min(a,b)+"px";if(a>b){this.zoomPlane.style.left=(a-b)/2+"px";this.zoomPlane.style.top=0}else{this.zoomPlane.style.top=(b-a)/2+"px";this.zoomPlane.style.left=0}},getPhoto:function(a,b){return this.container.querySelector(h('.p-photo[data-row="{row}"][data-column="{column}"]',a,b))},getSelectedPhoto:function(){return this.container.querySelector(".p-photo.selected")},setSelectedPhoto:function(a){var b=
this.getSelectedPhoto();if(b){b.classList.remove("selected");b.classList.remove("flipped")}a.classList.add("selected");this.track();return a},cycle:function(a){var b=this.getSelectedPhoto(),e=b?parseInt(b.getAttribute("data-row"),10):0;b=b?parseInt(b.getAttribute("data-column"),10):0;switch(a){case "left":b=d.util.mod(b-1,this.columns);break;case "right":b=(b+1)%this.columns;break;case "up":e=d.util.mod(e-1,this.rows);break;case "down":e=(e+1)%this.rows;break;case "next":if(b<this.columns-1)b++;else{b=
0;e=e<this.rows-1?e+1:0}break;case "prev":if(b)b--;else{b=this.columns-1;e=e?e-1:this.rows-1}break}this.setSelectedPhoto(this.getPhoto(e,b))},sendFlickrRequest:function(a){this.photoLoadCount=0;this.container.classList.add("gallery-loading");d.util.getJSON(a,this.onFlickrResult)},onFlickrResult:function(a){a.photos.photo.forEach(function(b,e){this.photos[e].insertFlickrData(b)},this);this.photoLoadCount+=this.photos.length-a.photos.photo.length;this.photos.slice(a.photos.photo.length).forEach(function(b){b.setSource("")})},
getFlickrPage:function(a){this.page=a>0?a:1;this.sendFlickrRequest(h(this.feed,{page:this.page}))},getNextFlickrPage:function(){this.getFlickrPage(this.page+1)},zoomIn:function(){this.container.classList.add("zoomed");this.zoomed=true;this.zoomPlane.style.webkitTransform=c;this.track();this.tilting||this.tilt()},zoomOut:function(){this.container.classList.remove("zoomed");this.zoomed=false;this.zoomPlane.style.webkitTransform=c.translate(0,0,-this.rows*800);this.track()},track:function(){var a;if(this.zoomed){a=
this.getSelectedPhoto();a=h("translate3d({x}%, {y}%, -150px)",{x:a.getAttribute("data-column")*-100,y:a.getAttribute("data-row")*-100})}else a=h("translate3d({x}%, {y}%, 1px)",{x:this.columns/2*-100+50,y:this.rows/2*-100+50});this.trackingPlane.style.webkitTransform=a},tilt:function(){var a=this.zoomed&&f.orientation===undefined?this.allowedRotation/4:this.allowedRotation;this.tilting=true;this.rotationDelta.x=(a*(this.movementCoordinates.y-0.5)-this.currentRotation.x)/this.tiltLag;this.rotationDelta.y=
(a*(this.movementCoordinates.x-0.5)+this.currentRotation.y)/this.tiltLag;this.currentRotation.x+=this.rotationDelta.x;this.currentRotation.y-=this.rotationDelta.y;this.tiltPlane.style.webkitTransform=c.rotate(this.currentRotation.x,this.currentRotation.y,0);if(Math.abs(this.rotationDelta.x)+Math.abs(this.rotationDelta.y)>0.05)setTimeout(this.tilt,1E3/30);else this.tilting=false},onPhotoLoaded:function(){this.photoLoadCount++;this.photoLoadCount===this.photos.length&&this.container.classList.remove("gallery-loading")},
onPhotoClickDelegate:function(a){var b=d.util.ancestor(a.target,".p-photo");a.target!==b&&a.stopPropagation();this.setSelectedPhoto(b);this.zoomed||this.zoomIn()},onViewportMouseWheel:function(a){a.wheelDelta<0?this.zoomOut():this.onPhotoClickDelegate(a)},onKeyDown:function(a){switch(a.keyCode){case 37:this.cycle("left");break;case 39:this.cycle("right");break;case 38:this.cycle("up");break;case 40:this.cycle("down");break;case 13:this.getSelectedPhoto().classList.toggle("flipped");break;case 82:this.getNextFlickrPage();
break;case 32:this.zoomed?this.zoomOut():this.zoomIn();break}},onContainerMouseMove:function(a){this.movementCoordinates=d.util.localCoordinates(a,this.container);this.tilting||this.tilt()},onDeviceMotion:function(a){var b=f.orientation%180===0,e=b?"x":"y";b=b?"y":"x";var j;j={x:f.orientation===180||f.orientation===90?-1:1,y:f.orientation===0||f.orientation===90?-1:1};this.movementCoordinates.x=(j[e]*a.accelerationIncludingGravity[e]+10)/20;this.movementCoordinates.y=(j[b]*a.accelerationIncludingGravity[b]+
10)/20;this.tilting||this.tilt()},onOrientationChange:function(){this.constrainLayout()}};d.setup=function(a){if(Modernizr&&Modernizr.webkitmatchesselector&&Modernizr.csstransforms3d)return new d.Gallery(a)}})(this);
(function(f){var d=f.pivot||(f.pivot={}),g=f.document,h=d.util.supplant;d.Photo=function(c){this.row=c.row;this.column=c.column;this.rows=c.rows;this.quality=c.quality;this.loadEvent=g.createEvent("Events");this.loadEvent.initEvent("load",true,false);this.container=d.util.makeElement("figure",{"class":"p-photo loading no-img","data-row":this.row,"data-column":this.column});this.container.style.webkitTransform=h("translate3d({x}%, {y}%, 1px)",{x:this.column*100,y:this.row*100});this.backing=d.util.makeElement("div",
{"class":"p-backing"});this.backing.style.cssText=h("-webkit-transform: translate3d({x}px, {y}px, {z}px) rotate({r}deg); opacity: 0;",{x:Math.random()*2E3-1E3,y:Math.random()*2E3-1E3,z:Math.random()*-16000,r:Math.random()*-16000});this.container.appendChild(this.backing);this.imageWrapper=d.util.makeElement("div",{"class":"p-image-wrapper"});this.container.appendChild(this.imageWrapper);this.caption=d.util.makeElement("figcaption");this.imageWrapper.appendChild(this.caption);this.image=d.util.makeElement("img",
{draggable:false});this.imageWrapper.appendChild(this.image);this.imagePreloader=new Image;c.container.appendChild(this.container);this.completeLoading=this.completeLoading.bind(this);this.imagePreloader.addEventListener("load",this.onImagePreloaderLoad.bind(this),false);this.imagePreloader.addEventListener("error",this.onImagePreloaderError.bind(this),false);this.imageWrapper.addEventListener("click",this.onImageWrapperClick.bind(this),false);this.backing.addEventListener("webkitAnimationEnd",this.onBackingAnimationEnd.bind(this),
false);setTimeout(this.resetBackingTransform.bind(this),0)};d.Photo.prototype={setSource:function(c){if(this.image.src!==c){this.container.classList.add("loading");this.container.classList.remove("flipped");this.imagePreloader.src=c}else this.onImagePreloaderError()},setCaption:function(c){this.caption.innerHTML=c},insertFlickrData:function(c){c.pageURL=h(d.flickr.pageURL,c);c.title=c.title||"Untitled";this.setCaption(h(d.flickr.captionTemplate,c));this.setSource(h(d.flickr.sourceURLs[this.quality],
c))},resetBackingTransform:function(){this.backing.style.cssText=""},completeLoading:function(){this.image.src=this.imagePreloader.src;var c=this.image.naturalWidth/this.image.naturalHeight;this.wrapperDimensions=c>1?h("top: {top}%; left: 5%; width: 90%; height: {height}%;",{top:(100-90/c)/2,height:90/c}):h("top: 5%; left: {left}%; width: {width}%; height: 90%;",{left:(100-90*c)/2,width:90*c});this.imageWrapper.style.cssText=this.wrapperDimensions;this.container.classList.remove("loading");this.container.classList.remove("no-img");
this.container.classList.add("done-loading");this.container.dispatchEvent(this.loadEvent)},onBackingAnimationEnd:function(){this.backing.style.cssText=this.wrapperDimensions;this.container.classList.remove("done-loading")},onImagePreloaderLoad:function(){setTimeout(this.completeLoading,(this.column+this.row*this.rows)*250)},onImagePreloaderError:function(){this.container.classList.add("no-img");this.container.dispatchEvent(this.loadEvent)},onImageWrapperClick:function(c){if(this.container.webkitMatchesSelector(".pivot.zoomed .p-photo.selected")){c.stopPropagation();
this.container.classList.toggle("flipped")}}}})(this);
(function(f){(f.pivot||(f.pivot={})).flickr={captionTemplate:'<h1><a href="{pageURL}" target="blank" tabindex="-1">{title}</a></h1><p> By {ownername}</p>',sourceURLs:{high:"http://farm{farm}.static.flickr.com/{server}/{id}_{secret}_b.jpg",medium:"http://farm{farm}.static.flickr.com/{server}/{id}_{secret}_z.jpg",low:"http://farm{farm}.static.flickr.com/{server}/{id}_{secret}_m.jpg"},pageURL:"http://www.flickr.com/photos/{owner}/{id}",feeds:{user:"http://api.flickr.com/services/rest/?method=flickr.people.getPublicPhotos&api_key=6fff138dbd0fbe330c07a67c47c9cc21&user_id={userId}&per_page={perPage}&page={page}&extras=description,owner_name&format=json&nojsoncallback=1",group:"http://api.flickr.com/services/rest/?method=flickr.groups.pools.getPhotos&api_key=6fff138dbd0fbe330c07a67c47c9cc21&group_id={groupId}&per_page={perPage}&page={page}&extras=description,owner_name&format=json&nojsoncallback=1",
interesting:"http://api.flickr.com/services/rest/?method=flickr.interestingness.getList&api_key=6fff138dbd0fbe330c07a67c47c9cc21&per_page={perPage}&page={page}&extras=description,owner_name&format=json&nojsoncallback=1"}}})(this);